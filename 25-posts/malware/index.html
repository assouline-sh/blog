<!DOCTYPE html>
<html lang="en-us">
    <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <meta name="generator" content="Hugo 0.120.4">

    

    

    
        
            <meta
                name="description"
                content="" />
        

        
            <meta
                name="keywords"
                content="" />
        

        
            <meta
                name="author"
                content="" />
        

    


    <title>
        
            Linux Malware |
            assouline.sh
        
    </title>

    


    
    

    
    


    
    


    
    


    
    

    


    
    

    

    

        
        


        
        


        <link
            rel="stylesheet"
            href="/css/index_d751713.min.73944e1c3e11524aed882591ed7acbb874d164cb228381a8f3b14d443f325270b85d14a3566733c8d82181f67f11948a884b7b90e4f7b3c9715d2ce9beff9105.css"
            integrity="sha512-c5ROHD4RUkrtiCWR7XrLuHTRZMsig4Go87FNRD8yUnC4XRSjVmczyNghgfZ/EZSKiEt7kOT3s8lxXSzpvv&#43;RBQ==" />
    


    
    

    

    

    

    
</head>



    <body>
        <header class="header">
    <div class="header_left">
        
    </div>

    <div class="header_middle">
        
            Linux Malware -
            assouline.sh
        
    </div>
</header>



        <main>
            <aside class="sidebar">
    



    
    

    

    
    

    
        
        
    

    

    
    


    <ul class="section-tree">
        
            
                <li
                    
                        class="dir closed-dir"
                    >
                    <span class="dir-text"> &#39;22 Posts </span>

                    



    
    

    

    
    

    
        
        
    

    

    
    


    <ul class="section-tree">
        
            
                <li class="file">
                    <a href="https://blog.assouline.sh/22-posts/edx/" title="./22-posts/edx/">
                        
                            EdX: Basic Network and Database Security
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://blog.assouline.sh/22-posts/wicys/" title="./22-posts/wicys/">
                        
                            WiCyS Conference
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://blog.assouline.sh/22-posts/cy2550/" title="./22-posts/cy2550/">
                        
                            CY2550: Foundations of Cybersecurity
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://blog.assouline.sh/22-posts/feature/" title="./22-posts/feature/">
                        
                            Featured on Khoury Website
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://blog.assouline.sh/22-posts/cs3500/" title="./22-posts/cs3500/">
                        
                            CS3500: Object Oriented Design
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://blog.assouline.sh/22-posts/udemy/" title="./22-posts/udemy/">
                        
                            Udemy: Complete Ethical Hacking Course
                        
                    </a>
                </li>
            
        
    </ul>


                </li>
            
        
            
                <li
                    
                        class="dir closed-dir"
                    >
                    <span class="dir-text"> &#39;23 Posts </span>

                    



    
    

    

    
    

    
        
        
    

    

    
    


    <ul class="section-tree">
        
            
                <li class="file">
                    <a href="https://blog.assouline.sh/23-posts/security/" title="./23-posts/security/">
                        
                            CompTIA Security&#43; Certification
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://blog.assouline.sh/23-posts/cy3740/" title="./23-posts/cy3740/">
                        
                            CY3740: System Security
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://blog.assouline.sh/23-posts/ccdc23/" title="./23-posts/ccdc23/">
                        
                            5th at National CCDC Competition
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://blog.assouline.sh/23-posts/ctfclub/" title="./23-posts/ctfclub/">
                        
                            Starting CTF Club at Northeastern
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://blog.assouline.sh/23-posts/cyberforce/" title="./23-posts/cyberforce/">
                        
                            10th at Cyberforce Competition
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://blog.assouline.sh/23-posts/cptc/" title="./23-posts/cptc/">
                        
                            Collegiate Pentesting Competition
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://blog.assouline.sh/23-posts/keyborb/" title="./23-posts/keyborb/">
                        
                            First Keyboard Build
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://blog.assouline.sh/23-posts/subzero/" title="./23-posts/subzero/">
                        
                            CTF Club: Sub-Z3r0 CTF
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://blog.assouline.sh/23-posts/cysa/" title="./23-posts/cysa/">
                        
                            CompTIA CySA&#43; Certification
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://blog.assouline.sh/23-posts/draper/" title="./23-posts/draper/">
                        
                            Cybersecurity Analyst at Draper
                        
                    </a>
                </li>
            
        
    </ul>


                </li>
            
        
            
                <li
                    
                        class="dir closed-dir"
                    >
                    <span class="dir-text"> &#39;24 Posts </span>

                    



    
    

    

    
    

    
        
        
    

    

    
    


    <ul class="section-tree">
        
            
                <li class="file">
                    <a href="https://blog.assouline.sh/24-posts/seatf/" title="./24-posts/seatf/">
                        
                            CTF Club: SeaTF
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://blog.assouline.sh/24-posts/rice/" title="./24-posts/rice/">
                        
                            Basic MacOS Rice
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://blog.assouline.sh/24-posts/ccdc24/" title="./24-posts/ccdc24/">
                        
                            7th at National CCDC Competition
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://blog.assouline.sh/24-posts/ecitadel/" title="./24-posts/ecitadel/">
                        
                            Captain for eCitadel Competition
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://blog.assouline.sh/24-posts/benchling/" title="./24-posts/benchling/">
                        
                            Security Engineer at Benchling
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://blog.assouline.sh/24-posts/cptc24/" title="./24-posts/cptc24/">
                        
                            Collegiate Pentesting Competition
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://blog.assouline.sh/24-posts/versus/" title="./24-posts/versus/">
                        
                            CTF Club: Versus CTF and CTF Thyme
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://blog.assouline.sh/24-posts/klaviyo/" title="./24-posts/klaviyo/">
                        
                            Security Engineer at Klaviyo
                        
                    </a>
                </li>
            
        
    </ul>


                </li>
            
        
            
                <li
                    
                        class="dir opened-dir"
                    >
                    <span class="dir-text"> &#39;25 Posts </span>

                    



    
    

    

    
    

    
        
        
    

    

    
    


    <ul class="section-tree">
        
            
                <li class="file">
                    <a href="https://blog.assouline.sh/25-posts/bigctf/" title="./25-posts/bigctf/">
                        
                            CTF Club: BIG CTF
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://blog.assouline.sh/25-posts/malware/" title="./25-posts/malware/">
                        
                            Linux Malware
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://blog.assouline.sh/25-posts/graduation/" title="./25-posts/graduation/">
                        
                            College Graduation
                        
                    </a>
                </li>
            
        
            
                <li class="file">
                    <a href="https://blog.assouline.sh/25-posts/defcon/" title="./25-posts/defcon/">
                        
                            DEFCON
                        
                    </a>
                </li>
            
        
    </ul>


                </li>
            
        
            
                <li
                    
                        class="dir closed-dir"
                    >
                    <span class="dir-text"> CTFs </span>

                    



    
    

    

    
    

    
        
        
    

    

    
    


    <ul class="section-tree">
        
            
                <li class="file">
                    <a href="https://blog.assouline.sh/ctf/blah/" title="./ctf/blah/">
                        
                            My First Post
                        
                    </a>
                </li>
            
        
    </ul>


                </li>
            
        
            
                <li
                    
                        class="dir closed-dir"
                    >
                    <span class="dir-text"> Projects </span>

                    



    
    

    

    
    

    
        
        
    

    

    
    


    <ul class="section-tree">
        
            
                <li class="file">
                    <a href="https://blog.assouline.sh/projects/projects/" title="./projects/projects/">
                        
                            Projects
                        
                    </a>
                </li>
            
        
    </ul>


                </li>
            
        
            
                <li
                    
                        class="dir closed-dir"
                    >
                    <span class="dir-text"> Resources </span>

                    



    
    

    

    
    

    
        
        
    

    

    
    


    <ul class="section-tree">
        
            
                <li class="file">
                    <a href="https://blog.assouline.sh/resources/resources/" title="./resources/resources/">
                        
                            Resources
                        
                    </a>
                </li>
            
        
    </ul>


                </li>
            
        
    </ul>


</aside>
<aside class="exapandable"></aside>


            
    <article class="main">
        <button
    class="sidebar-toggle-btn"
    type="menu"
    aria-expanded="false"
    aria-haspopup="true">
    <i class="bi bi-list"></i>
</button>



        <div class="title">
            <h1 class="title-header">
                Linux Malware
            </h1>

            <div class="author-date-readtime">

                
                    <div class="date" title="Date">
                        <i class="bi bi-calendar3"></i>
                        <time
                            datetime="2025.04.19"
                            >2025.04.19
                        </time>
                    </div>
                

            </div>
        </div>

        <div class="article-meta">
            

            
                <div class="tags">
                    <i
                        class="bi bi-tags"
                        title="Tags"></i>
                    
                        <a
                            href="/tags/course/"
                            class="tag-btn">
                            course
                        </a>
                    
                </div>
            

            
                <div class="breadcumb">
                    <i class="bi bi-folder"></i>
                    
    
    




<a href="https://blog.assouline.sh/" class="bread-btn">
    
        <i class="bi bi-house-fill"></i>
    

    
        Home
    
</a>




    /



<a href="https://blog.assouline.sh/25-posts/" class="bread-btn">
    

    
        &#39;25 Posts
    
</a>




    /



<a href="https://blog.assouline.sh/25-posts/malware/" class="bread-btn">
    

    
        
            Linux Malware
        

    
</a>

                </div>
            
        </div>


        <div class="content">
            
                <p>My last semester, I wanted to take advantage of one of the last opportunities I may have to take a truly challenging class. We learned the basics of reverse engineering, and for the final project my group and I wrote our own malware- including the client and C2 server as well as the implant- to target an ARM-based Linux raspberry pi.</p>
<p>Our malware worked as follows:<br>
Once our implant is successfully loaded onto our target, it calls out to our C2 over TLS to register itself and obtain an ID for future communications. Our C2 also creates a DNS record for each registered implant since we use DNS records as a task signaling channel. We built out a pretty feature-rich client UI to interact with the implant, which I now realize we didn&rsquo;t take screenshots of, except for two tiny images on our poster shown below -_-. Nonetheless, once an implant is registered, it has its own webpage in the client where you can check its status, see basic info like hostname and ip, assign tasks, and receive results of tasks. Tasks included host awareness, arbitrary command execution, file i/o, process injection, and a kill switch.</p>
<p>Periodically with a jitter, our implant will make a DNS request over HTTPS to its unique DNS record in Cloudflare to check if there&rsquo;s a task assigned to it; a record of 1.1.1.0 signals there are no waiting tasks while a record of 1.1.1.1 signals there is. We used DoH for check-ins to ensure our implant remained stealthy and blended in with other common network traffic. Only once the implant confirms there is a task will it make a request to a special C2 endpoint to retrieve it. The implant will then execute the task and return the response to the C2 which will store it so the Client can render the result.</p>
<p>Now I&rsquo;ll go into slightly further implementation detail of various implant tasks.<br>
Host awareness: We implemented our own versions of several CLI commands to ensure our implant remained stealthy on the host machine. This includes retrieving running processes by walking the proc table instead of using ps, and listing files in an open directory with dirent/opendir, etc.<br>
Arbitrary command execution: The implant creates a child process which uses execve to run the command, and redirects stdout and stdin to the created pipe. The parent process receives the piped output and it&rsquo;s then sent back to the C2 in a protobuf message.<br>
File I/O: Our implant and C2 can chunk a large 1GB+ file and reliably transmit it and ensure proper reassembly without writing additional files or reading the whole file into memory.<br>
Process Injection: Given a process name and a shared object to inject, our implant will attach to the target process, allocate memory for the shared object, then write it into the target process&rsquo;s memory and execute dlopen on it. We find the pid of the process by walking the /proc table, and use it in calling ptrace to attach to the target process. We calculate the process&rsquo;s mmap and dlopen locations. We wrote a function remote_call to find and overwrite the process&rsquo;s current return address with a BRK instruction and overwrite the current registers with arguments for our command and the program counter pointing to our function address. When the process hits the breakpoint, we reset the return address and registers. We called remote_call with mmap and dlopen so we could write the path of the shared object into the victim process&rsquo;s buffer and call dlopen.</p>
<p>The final environment and the exploit:<br>
We were given the OVA of our final environment to reverse engineer and determine how to exploit. The environment was running a backup service which had two different processes that communicate via a Unix socket, one with no filesystem access but network access, and the child process with filesystem access but no network access. The HTTP server also allowed for runtime patches to be sent as shellcode, which essentially led to allowing for arbitrary shellcode execution in the environment.</p>
<p>I wasn&rsquo;t really involved in developing the exploit mechanism, but my team created a reflective memfd payload to grab our implant from the C2 server via HTTPS, create a memfd buffer to write our implant to, and call dlopen to open our implant, as it&rsquo;s available as a shared object.</p>
<p>Once in the environment, our malware&rsquo;s goal was to exfilitrate the service&rsquo;s stored messages. To do this, we listened on a socket in a parent process and used ptrace to run a shared object in the child process to open another socket and connect it, and then send the file descriptor for each file in the messages directory. The parent process receives these file descriptors, copies its contents to a buffer, and then sends them back to our C2.</p>
<p>This was absolutely the hardest class I&rsquo;ve ever taken, and I&rsquo;m so glad I did. It definitely felt like a pressure cooker at times, with so much to do in only a couple months and also being completely lost at several points. However, it definitely inspired some intense learning. At the end of the semester, we had a poster presentation session, and ours is below.</p>
<p>Thanks for reading!</p>
<hr>
<p><img src="/img/malware.png" alt="malware"></p>
<hr>

            
        </div>
    </article>

        </main>

        <footer class="footer">
    <div class="footer-left">
        <ul class="social">
            

            
                
            
                
            
                
                    <li>
                        
                            <a href="https://github.com/assouline-sh" target="_blank">
                                <i class="bi-github"></i>
                            </a>
                        

                    </li>
                
            
                
            
                
                    <li>
                        
                            <a href="https://www.linkedin.com/in/assouline-sh/" target="_blank">
                                <i class="bi-linkedin"></i>
                            </a>
                        

                    </li>
                
            
                
            
                
            
                
            
                
            
                
            
        </ul>
    </div>

    <div class="footer-right">
        <ul class="control status clearfix">
            
                <li>
                    
                        Word Count:
                        869
                    
                </li>
            

            
                <li>
                    
                        Last modified: &nbsp;
                        <time>
                            Apr 19 2025 00:00:00
                        </time>
                    
                </li>
            

            
                <li title="">
                    
                </li>
            
        </ul>
    </div>
</footer>

    </body>

    























    
    


    
    


    <script
        type="text/javascript"
        src="/js/index_d751713.min.5eeb120f16ea146352725c420364f87befead45f678142b8f0ffbef024646931fbc06bff07a7bd6cb57fa2f8cd8a21ba6a4ee5a278ec32303a378bc1cd17f246.js"
        integrity="sha512-XusSDxbqFGNSclxCA2T4e&#43;/q1F9ngUK48P&#43;&#43;8CRkaTH7wGv/B6e9bLV/ovjNiiG6ak7lonjsMjA6N4vBzRfyRg=="></script>














<link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" />




</html>
